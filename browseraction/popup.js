var playList = [
    { 'PlayList':  'https://open.spotify.com/album/6JlufXCEWasFpiuZkub1Gb'},
    { 'PlayList':  'https://open.spotify.com/album/0qOvEp6Q875hjqwEwp06Rr'},
    { 'PlayList':  'https://open.spotify.com/album/0L1w6S6avdrUuFQQcgo0HL'},
    { 'PlayList':  'https://open.spotify.com/album/7dNSYTevmvLKIv1NeKwVpA'},
    { 'PlayList':  'https://open.spotify.com/album/6B1XAWTo6gbgtScgT1iB1m'},
    { 'PlayList':  'https://open.spotify.com/album/6dr1ZIbgjLrLuRLfl345Ye'},
    { 'PlayList':  'https://open.spotify.com/album/213FEDFRraw4PTZJdEN3wZ'},
    { 'PlayList':  'https://open.spotify.com/album/26CWCTyTRAswYZUbluW9MP'},
    { 'PlayList':  'https://open.spotify.com/album/2htT5KY6ImOAn7NlwknPES'},
    { 'PlayList':  'https://open.spotify.com/album/00XHe8oyVUL4ef79kE7jfs'},
    { 'PlayList':  'https://open.spotify.com/album/7kN7rkOaaYllh0mGDHrj0U'},
    { 'PlayList':  'https://open.spotify.com/album/7e2pGH7HFePK606vaowgPF'},
    { 'PlayList':  'https://open.spotify.com/album/32BZUfvJkaOkdrVrIlSlzp'},
    { 'PlayList':  'https://open.spotify.com/album/76L8ayXGO3UkUQzybjCQTi'},
    { 'PlayList':  'https://open.spotify.com/album/17TEoScoTXXOYwcVl4Yd9l'},
    { 'PlayList':  'https://open.spotify.com/album/7dqmnbtz5KGeXjGqoQAbaS'},
    { 'PlayList':  'https://open.spotify.com/album/5e1D6oJL1ykmQOWB1n3xA2'},
    { 'PlayList':  'https://open.spotify.com/album/4tLM17m3zI0b1eULl5VxUs'},
    { 'PlayList':  'https://open.spotify.com/album/0a6lRxnEBWjgoS6vx06Wv9'},
    { 'PlayList':  'https://open.spotify.com/album/34Nqajddw3wY6De9vyjv7o'},
    { 'PlayList':  'https://open.spotify.com/album/6eIk8QaWWyPlDxjkX1gnkp'},
    { 'PlayList':  'https://open.spotify.com/album/3ssqYT10HBkCqlFYlPfaEr'},
    { 'PlayList':  'https://open.spotify.com/album/0HuUvQEaWzfLS6tw7NQ8uL'},
    { 'PlayList':  'https://open.spotify.com/album/3v125FSSk6xYYFG7f2jFai'},
    { 'PlayList':  'https://open.spotify.com/album/47ZLIoTHAyOrjo1FrgQW3K'},
    { 'PlayList':  'https://open.spotify.com/album/3V4UAbrxSlkxpCINyPVIbL'},
    { 'PlayList':  'https://open.spotify.com/album/4Fux4PJQTVsLqKY0KgkWob'},
    { 'PlayList':  'https://open.spotify.com/album/3vnGEYAF8MOnsXMtXds06t'},
    { 'PlayList':  'https://open.spotify.com/album/6aASAzGlZJJ9GNJjyS1tJS'},
    { 'PlayList':  'https://open.spotify.com/album/7r4EzmlELPhXmw97sXMcD5'},
    { 'PlayList':  'https://open.spotify.com/album/56VMfRkDFzUJEgGSlnAjX0'},
    { 'PlayList':  'https://open.spotify.com/album/28nrzbMagZPncT7eqVuLMN'},
    { 'PlayList':  'https://open.spotify.com/album/5Ue1bc7RPsuY1oiucZZezU'},
    { 'PlayList':  'https://open.spotify.com/album/5fFGcoBZ1t16CfRE1FybSF'},
    { 'PlayList':  'https://open.spotify.com/album/1dWL7pPl4Sdamo5w2VlqgB'},
    { 'PlayList':  'https://open.spotify.com/album/5sr3gPwVP7shuOvmtuYFBn'},
    { 'PlayList':  'https://open.spotify.com/album/0fk3LdU5IK1HhEVcwmJDCE'},
    { 'PlayList':  'https://open.spotify.com/album/6ghfFAQM0QrNy0GqGbvzVO'},
    { 'PlayList':  'https://open.spotify.com/album/0T2eeAqFwPqhMhg38w2p8V'},
    { 'PlayList':  'https://open.spotify.com/album/4QhgDRXyv1DpX7IohPO68m'},
    { 'PlayList':  'https://open.spotify.com/album/6LaO3PThrNwb37zWFQpUyk'},
    { 'PlayList':  'https://open.spotify.com/album/6W3sVzFgybUxlOHL8XrrwF'},
    { 'PlayList':  'https://open.spotify.com/album/7cWzOabirbeQZJ21ki7Uz0'},
    { 'PlayList':  'https://open.spotify.com/album/1WeUOJ28L5wY1FNEx4NALK'},
    { 'PlayList':  'https://open.spotify.com/album/72XXllyPyxEM1EJzic2HtL'},
    { 'PlayList':  'https://open.spotify.com/album/3MdNMCQQ5vFjcpkEMZo22l'},
    { 'PlayList':  'https://open.spotify.com/album/31oA55moDwovawiA1vQfOB'},
    { 'PlayList':  'https://open.spotify.com/album/0I9Ob3fE5v2Sg0Vjor1ZQt'},
    { 'PlayList':  'https://open.spotify.com/album/66a3OreLCdwWz0iHP0N3bV'},
    { 'PlayList':  'https://open.spotify.com/album/5fS5dK7SFWQPAPf9T6GM7r'},
    { 'PlayList':  'https://open.spotify.com/album/74jIBa2LsReq7QnLk2m4BR'},
    { 'PlayList':  'https://open.spotify.com/album/5wFyOu2IeFn2rdTPlnbwbz'},
    { 'PlayList':  'https://open.spotify.com/album/27zDqkFvFGOaa51YrzEe2j'},
    { 'PlayList':  'https://open.spotify.com/album/0tESH7RabohmejH94CS1Ws'},
    { 'PlayList':  'https://open.spotify.com/album/1hhTjTmHGHll4gXExp6iV9'},         
]
save.addEventListener("click", async () => {
    saveDados(true);
});

addPlayList.addEventListener('click', async () => {
    let valor = document.getElementById('linkPlaylist').value;
    if (valor == '') {
        alert("Link da playlist vazio!");
        return false;
    }

    var dados = {
        PlayList: valor
    }

    document.getElementById('linkPlaylist').value = '';

    playList.push(dados);
    saveDados();
    drawPlaylist(playList);
})

removePlayList.addEventListener('click', async () => {
    playList.pop();
    saveDados();
    drawPlaylist(playList);

})

window.onload = function () {
    chrome.storage.local.get(['tbDados'], function (result) {

        var dados = JSON.parse(result.tbDados)

        document.getElementById('timeRefresh').value = dados.TimeRefresh;
        document.getElementById('timePlay').value = dados.timePlay;
        document.getElementById('timeMinPause').value = dados.timeMinPause;
        document.getElementById('timeMaxPause').value = dados.timeMaxPause;
        document.getElementById('timeMinNextMusic').value = dados.timeMinNextMusic;
        document.getElementById('timeMaxNextMusic').value = dados.timeMaxNextMusic;
        document.getElementById('timeMinPlaylist').value = dados.timeMinPlaylist;
        document.getElementById('timeMaxPlaylist').value = dados.timeMaxPlaylist;
        //playList = dados.listMusic;



        drawPlaylist();
    });

    // document.getElementById("play").onclick = function () {
    //     chrome.extension.sendMessage({
    //         type: "play-music"
    //     });
    // }
}

function drawPlaylist() {

    var tabela = document.getElementById('tableLink');
    tabela.innerHTML = '';
    var numeroLinhas = tabela.rows.length;
    let cont = 0;
    playList.forEach(function (item) {
        var linha = tabela.insertRow(numeroLinhas);
        cont++;

        var celula1 = linha.insertCell(0);
        var celula2 = linha.insertCell(1);

        celula1.innerHTML = '<input class="form-check-input" type="checkbox" value="" id="playList_linha_' + cont + '>';
        celula2.innerHTML = item.PlayList;

    });
}

function getRandomInt(min, max) {
    min = Math.ceil(min);
    max = Math.floor(max);
    return Math.floor(Math.random() * (max - min)) + min;
}

function addMinutes(date, minutes) {
    return new Date(date.getTime() + minutes * 60000);
}

function saveDados(init) {

    var idRandomPlaylist = getRandomInt(
        document.getElementById('timeMinPlaylist').value,
        document.getElementById('timeMaxPlaylist').value
    );

    var idRandomPauselist = getRandomInt(
        document.getElementById('timeMinPause').value,
        document.getElementById('timeMaxPause').value
    );

    var idRandomNextMusic = getRandomInt(
        document.getElementById('timeMinNextMusic').value,
        document.getElementById('timeMaxNextMusic').value
    );

    let timerNow = addMinutes(new Date(), idRandomPlaylist);
    let timerPause = addMinutes(timerNow, idRandomPauselist);
    let timerNextMusic = addMinutes(new Date(), idRandomNextMusic);

    var dados = JSON.stringify({
        TimeRefresh: document.getElementById('timeRefresh').value,
        timePlay: document.getElementById('timePlay').value,
        timeMinPause: document.getElementById('timeMinPause').value,
        timeMaxPause: document.getElementById('timeMaxPause').value,
        timeMinNextMusic: document.getElementById('timeMinNextMusic').value,
        timeMaxNextMusic: document.getElementById('timeMaxNextMusic').value,
        timeMinPlaylist: document.getElementById('timeMinPlaylist').value,
        timeMaxPlaylist: document.getElementById('timeMaxPlaylist').value,
        lastTimeRestart: Date.now(),
        lastPlayList: 0,
        listMusic: playList,
        playListEndTime: timerNow.toString(),
        playListPauseTime: timerPause.toString(),
        musicEndTime: timerNextMusic.toString(),
        timeNextMusic: ''
    });

    chrome.storage.local.set({ tbDados: dados }, function () {
        try {
            if (init) {
                alert("Configurações salvas com sucesso.");
                initBackground();
            }

        } catch (error) {
            // Captura e lida com a exceção
            console.error("Ocorreu um erro:", error.message);
        }
    });

    return true;
}

function initBackground() {
    chrome.runtime.sendMessage({
        type: "reset-player"
    });
}
