var playList = [
    { 'PlayList': 'https://open.spotify.com/album/2htT5KY6ImOAn7NlwknPES' },
    // { 'PlayList': 'https://open.spotify.com/album/6p74hyYGqh63zSlEAASlbZ' },
    // { 'PlayList': 'https://open.spotify.com/album/6JlufXCEWasFpiuZkub1Gb' },
    // { 'PlayList': 'https://open.spotify.com/album/0qOvEp6Q875hjqwEwp06Rr' },
    // {'PlayList' : 'https://open.spotify.com/album/0L1w6S6avdrUuFQQcgo0HL'},
    // {'PlayList' : 'https://open.spotify.com/album/7dNSYTevmvLKIv1NeKwVpA'},
    // {'PlayList' : 'https://open.spotify.com/album/6B1XAWTo6gbgtScgT1iB1m'},
    // {'PlayList' : 'https://open.spotify.com/album/6dr1ZIbgjLrLuRLfl345Ye'},
    // {'PlayList' : 'https://open.spotify.com/album/213FEDFRraw4PTZJdEN3wZ'},
    // {'PlayList' : 'https://open.spotify.com/album/26CWCTyTRAswYZUbluW9MP'},
    // {'PlayList' : 'https://open.spotify.com/album/2htT5KY6ImOAn7NlwknPES'},
    // {'PlayList' : 'https://open.spotify.com/album/00XHe8oyVUL4ef79kE7jfs'},
    // {'PlayList' : 'https://open.spotify.com/album/7kN7rkOaaYllh0mGDHrj0U'},
    // {'PlayList' : 'https://open.spotify.com/album/7e2pGH7HFePK606vaowgPF'},
    // {'PlayList' : 'https://open.spotify.com/album/32BZUfvJkaOkdrVrIlSlzp'},
    // {'PlayList' : 'https://open.spotify.com/album/76L8ayXGO3UkUQzybjCQTi'},
    // {'PlayList' : 'https://open.spotify.com/album/17TEoScoTXXOYwcVl4Yd9l'},
    // {'PlayList' : 'https://open.spotify.com/album/7dqmnbtz5KGeXjGqoQAbaS'},
    // {'PlayList' : 'https://open.spotify.com/album/2pi25LR7aQFvgoat5FF2Ns'},
    // {'PlayList' : 'https://open.spotify.com/album/61c5E5zME0JFzvUio8uRbq'},
    // {'PlayList' : 'https://open.spotify.com/album/2vFWV3JI0tLO2O278f3vtq'},
    // {'PlayList' : 'https://open.spotify.com/album/7nyEdl7RDsTeku5FSKEyir'},
    // {'PlayList' : 'https://open.spotify.com/album/6AGaCrLlqnPC6BLvqYLhtE'},
    // {'PlayList' : 'https://open.spotify.com/album/7rq3m155Ez2Xnky2ZNpK2K'},
    // {'PlayList' : 'https://open.spotify.com/album/5yaH7N4YojGw5lkhfhh2ov'},
    // {'PlayList' : 'https://open.spotify.com/album/2LW0vgHUek08NPNxvaSr8o'},
    // {'PlayList' : 'https://open.spotify.com/album/47s72gENJWHyBXoQV3zCNS'},
    // {'PlayList' : 'https://open.spotify.com/album/3WJPnHq7NqFKuLKsC78dF3'},
    // {'PlayList' : 'https://open.spotify.com/album/2buLnkD6MzvrY3NSFU7FGa'},
    // {'PlayList' : 'https://open.spotify.com/album/14SCr2FhFXFYAbWG8ABrF9'},
    // {'PlayList' : 'https://open.spotify.com/album/52a8ST4F7zF5C51LPKrGOw'},
    // {'PlayList' : 'https://open.spotify.com/album/35j5RCRZR51unpBkgJsdYH'},
    // {'PlayList' : 'https://open.spotify.com/album/7GSpaP4Dqj60YtoGMVLerT'},
    // {'PlayList' : 'https://open.spotify.com/album/3boEEaG1PerhfN2VZ6Zttz'},
    // {'PlayList' : 'https://open.spotify.com/album/5TDdu06hXsDYYz19LwNJRu'},
    // {'PlayList' : 'https://open.spotify.com/album/1T0xIHaLfC1xZTVNoB89cu'},
    // {'PlayList' : 'https://open.spotify.com/album/4hGe7SX4G66CnLVCKcZ6MK'},
    // {'PlayList' : 'https://open.spotify.com/album/6O44imGwoVHAE1ZOtuVAcj'},
    // {'PlayList' : 'https://open.spotify.com/album/676bbJBJCjsdTlrEUybSJJ'},
    // {'PlayList' : 'https://open.spotify.com/album/5tKHPbGU7NP6Agj7sQ2zxP'},
    // {'PlayList' : 'https://open.spotify.com/album/2QjpIB4WKzB2hlijmDrcwI'},
    // {'PlayList' : 'https://open.spotify.com/album/4Ckdc7go7TnHRtSEo9xPSi'},
    // {'PlayList' : 'https://open.spotify.com/album/4CjDqv7zreQFG5fej0w0Ky'},
    // {'PlayList' : 'https://open.spotify.com/album/3dRwhASQegyv8yLbbPJiCK'},
    // {'PlayList' : 'https://open.spotify.com/album/17kQjvSLghC62qLM4bIXFa'},
    // {'PlayList' : 'https://open.spotify.com/album/5e1D6oJL1ykmQOWB1n3xA2'},
    // {'PlayList' : 'https://open.spotify.com/album/4tLM17m3zI0b1eULl5VxUs'},
    // {'PlayList' : 'https://open.spotify.com/album/0a6lRxnEBWjgoS6vx06Wv9'},
    // {'PlayList' : 'https://open.spotify.com/album/34Nqajddw3wY6De9vyjv7o'},
    // {'PlayList' : 'https://open.spotify.com/album/6eIk8QaWWyPlDxjkX1gnkp'},
    // {'PlayList' : 'https://open.spotify.com/album/3ssqYT10HBkCqlFYlPfaEr'},
    // {'PlayList' : 'https://open.spotify.com/album/0HuUvQEaWzfLS6tw7NQ8uL'},
    // {'PlayList' : 'https://open.spotify.com/album/3v125FSSk6xYYFG7f2jFai'},
    // {'PlayList' : 'https://open.spotify.com/album/47ZLIoTHAyOrjo1FrgQW3K'},
    // {'PlayList' : 'https://open.spotify.com/album/3V4UAbrxSlkxpCINyPVIbL'},
    // {'PlayList' : 'https://open.spotify.com/album/4Fux4PJQTVsLqKY0KgkWob'},
    // {'PlayList' : 'https://open.spotify.com/album/4Fux4PJQTVsLqKY0KgkWob'},
    // {'PlayList' : 'https://open.spotify.com/album/7Fx9duY8erg1iUZTTVxs4W'},
    // {'PlayList' : 'https://open.spotify.com/album/3m3e34PxrAf4xKILopuHCS'},
    // {'PlayList' : 'https://open.spotify.com/album/6ufcjqPE41P79EOzcJd8me'},
    // {'PlayList' : 'https://open.spotify.com/album/2QHhNtZrKH7G96fh8Ghvyu'},
    // {'PlayList' : 'https://open.spotify.com/album/5LKGGIy2xerizIM4OYenA2'},
    // {'PlayList' : 'https://open.spotify.com/album/0tluLunPIi8Am6bfyrBmuZ'},
    // {'PlayList' : 'https://open.spotify.com/album/3gaVBUauiChFetnsX3FIZ5'},
    // {'PlayList' : 'https://open.spotify.com/album/2J2W8l97xjmbzlpo5bcqh4'},
    // {'PlayList' : 'https://open.spotify.com/album/2YMLCzhAjkk0kbpaDtT85S'},
    // {'PlayList' : 'https://open.spotify.com/album/5LBPKqP2cpJCw1QKcap8O5'},
    // {'PlayList' : 'https://open.spotify.com/album/7dQyConZ9Fx7DLY8sOHWE8'},
    // {'PlayList' : 'https://open.spotify.com/album/5sk8o57tm54dzZVs1DES7q'},
    // {'PlayList' : 'https://open.spotify.com/album/7GCzPL2CHUIPJwXyfTQv8U'},
    // {'PlayList' : 'https://open.spotify.com/album/06dpRxrLDOVMC88KgrFYxe'},
    // {'PlayList' : 'https://open.spotify.com/album/24mx6DEK8VGLZHRAQfMkUg'},
    // {'PlayList' : 'https://open.spotify.com/album/5FRZhDh7djK3KDnMOrALeA'},
    // {'PlayList' : 'https://open.spotify.com/album/7gm3RpaVJKbkiByZta8ldo'},
    // {'PlayList' : 'https://open.spotify.com/album/3RkgFqamGvd7QrIAupy7DQ'},
    // {'PlayList' : 'https://open.spotify.com/album/45FaIe3V3uQ379BZOemUW6'},
    // {'PlayList' : 'https://open.spotify.com/album/6R8DWKmbtoMpZOT8ZINni4'},
    // {'PlayList' : 'https://open.spotify.com/album/0ef4R8yfEcd0u1axYtX6p0'},
    // {'PlayList' : 'https://open.spotify.com/album/56pFHpzUSNSSpztIIbZhDw'},
    // {'PlayList' : 'https://open.spotify.com/album/5hV2WZvmZ94wOQf69qmBNb'},
    // {'PlayList' : 'https://open.spotify.com/album/4J1eO6JQ52GM3TdLdytFa0'},
    // {'PlayList' : 'https://open.spotify.com/album/4hqkOphDDabv0KxnbuvipG'},
    // {'PlayList' : 'https://open.spotify.com/album/3B8Ges1ZC0jT8oURv67hQQ'},
    // {'PlayList' : 'https://open.spotify.com/album/5LPM0TN07mojyCQTqIWogd'},
    // {'PlayList' : 'https://open.spotify.com/album/3JNOdYAp3YX1rTsldVX9PP'},
    // {'PlayList' : 'https://open.spotify.com/album/1oKeDGFlc6Ccy5Tq9RPOU6'},
    // {'PlayList' : 'https://open.spotify.com/album/1Nrtm4MH0fmm1fuxDN0Daw'},
    // {'PlayList' : 'https://open.spotify.com/album/0rtib2UXPo8qJ2BYOa6hrW'},
    // {'PlayList' : 'https://open.spotify.com/album/7IDmBLGcTZYSYEztxsOJTe'},
    // {'PlayList' : 'https://open.spotify.com/album/6Z7RLBm0pkNa3p7ItSrOrK'},
    // {'PlayList' : 'https://open.spotify.com/album/5DScvuauuHZltRgrwPhXHq'},
    // {'PlayList' : 'https://open.spotify.com/album/26RCsUtrPzFKlg1J1YMAxN'},
    // {'PlayList' : 'https://open.spotify.com/album/0I0xG5X2t0vLGJWDhvQYkt'},
    // {'PlayList' : 'https://open.spotify.com/album/4gSIO9X61dYxbCntPrBLfu'},
    // {'PlayList' : 'https://open.spotify.com/album/4txPjNpmdETImTegTP0b30'},
    // {'PlayList' : 'https://open.spotify.com/album/0BzhCEJlinVPtumUmYLi5y'},
    // {'PlayList' : 'https://open.spotify.com/album/7iEI69lDMLMtkiJt6RyhVT'},
    // {'PlayList' : 'https://open.spotify.com/album/7L3mrzBSFBanZT870mMDvF'},
    // {'PlayList' : 'https://open.spotify.com/album/1DhbwGwHUPTRXLPJDv3hKR'},
    // {'PlayList' : 'https://open.spotify.com/album/7fdfrbD55ckHSGJUaZDQD7'},
    // {'PlayList' : 'https://open.spotify.com/album/5BNRY8eHODt3yGkaSIgAru'},
    // {'PlayList' : 'https://open.spotify.com/album/4jVOIOoWGiMxSFcrIfd6RC'},
    // {'PlayList' : 'https://open.spotify.com/album/1OV0UrahwRrtVj34aAiNqy'},
    // {'PlayList' : 'https://open.spotify.com/album/14WdGc1Ji2XIKLOc4xc5g2'},
    // {'PlayList' : 'https://open.spotify.com/album/3vnGEYAF8MOnsXMtXds06t'},
    // {'PlayList' : 'https://open.spotify.com/album/6aASAzGlZJJ9GNJjyS1tJS'},
    // {'PlayList' : 'https://open.spotify.com/album/7r4EzmlELPhXmw97sXMcD5'},
    // {'PlayList' : 'https://open.spotify.com/album/56VMfRkDFzUJEgGSlnAjX0'},
    // {'PlayList' : 'https://open.spotify.com/album/28nrzbMagZPncT7eqVuLMN'},
    // {'PlayList' : 'https://open.spotify.com/album/5Ue1bc7RPsuY1oiucZZezU'},
    // {'PlayList' : 'https://open.spotify.com/album/5fFGcoBZ1t16CfRE1FybSF'},
    // {'PlayList' : 'https://open.spotify.com/album/1dWL7pPl4Sdamo5w2VlqgB'},
    // {'PlayList' : 'https://open.spotify.com/album/5sr3gPwVP7shuOvmtuYFBn'},
    // {'PlayList' : 'https://open.spotify.com/album/0fk3LdU5IK1HhEVcwmJDCE'},
    // {'PlayList' : 'https://open.spotify.com/album/6ghfFAQM0QrNy0GqGbvzVO'},
    // {'PlayList' : 'https://open.spotify.com/album/0T2eeAqFwPqhMhg38w2p8V'},
    // {'PlayList' : 'https://open.spotify.com/album/4QhgDRXyv1DpX7IohPO68m'},
    // {'PlayList' : 'https://open.spotify.com/album/6LaO3PThrNwb37zWFQpUyk'},
    // {'PlayList' : 'https://open.spotify.com/album/4gq8zwBn4gFfrGDrRy6bw0'},
    // {'PlayList' : 'https://open.spotify.com/album/6W3sVzFgybUxlOHL8XrrwF'},
    // {'PlayList' : 'https://open.spotify.com/album/7cWzOabirbeQZJ21ki7Uz0'},
    // {'PlayList' : 'https://open.spotify.com/album/1WeUOJ28L5wY1FNEx4NALK'},
    // {'PlayList' : 'https://open.spotify.com/album/72XXllyPyxEM1EJzic2HtL'},
    // {'PlayList' : 'https://open.spotify.com/artist/7qPLO2XOUaRrRxkvLZ3AEK'},
    // {'PlayList' : 'https://open.spotify.com/artist/2CKOmarVWvWqkNWUatHCex'},
    // {'PlayList' : 'https://open.spotify.com/artist/2eK9gcJQ6uqVvJL63dnOM3'},
    // {'PlayList' : 'https://open.spotify.com/artist/4O2WXMRRTS8XqmqSTcBnrb'},         
]
save.addEventListener("click", async () => {
    saveDados(true);
});

addPlayList.addEventListener('click', async () => {
    let valor = document.getElementById('linkPlaylist').value;
    if (valor == '') {
        alert("Link da playlist vazio!");
        return false;
    }

    var dados = {
        PlayList: valor
    }

    document.getElementById('linkPlaylist').value = '';

    playList.push(dados);
    saveDados();
    drawPlaylist(playList);
})

removePlayList.addEventListener('click', async () => {
    playList.pop();
    saveDados();
    drawPlaylist(playList);

})

window.onload = function () {
    chrome.storage.local.get(['tbDados'], function (result) {

        var dados = JSON.parse(result.tbDados)

        document.getElementById('timeRefresh').value = dados.TimeRefresh;
        document.getElementById('timePlay').value = dados.timePlay;
        document.getElementById('timeMinPause').value = dados.timeMinPause;
        document.getElementById('timeMaxPause').value = dados.timeMaxPause;
        document.getElementById('timeMinNextMusic').value = dados.timeMinNextMusic;
        document.getElementById('timeMaxNextMusic').value = dados.timeMaxNextMusic;
        document.getElementById('timeMinPlaylist').value = dados.timeMinPlaylist;
        document.getElementById('timeMaxPlaylist').value = dados.timeMaxPlaylist;
        //playList = dados.listMusic;



        drawPlaylist();
    });

    // document.getElementById("play").onclick = function () {
    //     chrome.extension.sendMessage({
    //         type: "play-music"
    //     });
    // }
}

function drawPlaylist() {

    var tabela = document.getElementById('tableLink');
    tabela.innerHTML = '';
    var numeroLinhas = tabela.rows.length;
    let cont = 0;
    playList.forEach(function (item) {
        var linha = tabela.insertRow(numeroLinhas);
        cont++;

        var celula1 = linha.insertCell(0);
        var celula2 = linha.insertCell(1);

        celula1.innerHTML = '<input class="form-check-input" type="checkbox" value="" id="playList_linha_' + cont + '>';
        celula2.innerHTML = item.PlayList;

    });
}

function getRandomInt(min, max) {
    min = Math.ceil(min);
    max = Math.floor(max);
    return Math.floor(Math.random() * (max - min)) + min;
}

function addMinutes(date, minutes) {
    return new Date(date.getTime() + minutes * 60000);
}

function saveDados(init) {

    var idRandomPlaylist = getRandomInt(
        document.getElementById('timeMinPlaylist').value,
        document.getElementById('timeMaxPlaylist').value
    );

    var idRandomPauselist = getRandomInt(
        document.getElementById('timeMinPause').value,
        document.getElementById('timeMaxPause').value
    );

    var idRandomNextMusic = getRandomInt(
        document.getElementById('timeMinNextMusic').value,
        document.getElementById('timeMaxNextMusic').value
    );

    let timerNow = addMinutes(new Date(), idRandomPlaylist);
    let timerPause = addMinutes(timerNow, idRandomPauselist);
    let timerNextMusic = addMinutes(new Date(), idRandomNextMusic);

    var dados = JSON.stringify({
        TimeRefresh: document.getElementById('timeRefresh').value,
        timePlay: document.getElementById('timePlay').value,
        timeMinPause: document.getElementById('timeMinPause').value,
        timeMaxPause: document.getElementById('timeMaxPause').value,
        timeMinNextMusic: document.getElementById('timeMinNextMusic').value,
        timeMaxNextMusic: document.getElementById('timeMaxNextMusic').value,
        timeMinPlaylist: document.getElementById('timeMinPlaylist').value,
        timeMaxPlaylist: document.getElementById('timeMaxPlaylist').value,
        lastTimeRestart: Date.now(),
        lastPlayList: 0,
        listMusic: playList,
        playListEndTime: timerNow.toString(),
        playListPauseTime: timerPause.toString(),
        musicEndTime: timerNextMusic.toString(),
        timeNextMusic: ''
    });

    chrome.storage.local.set({ tbDados: dados }, function () {
        try {
            if (init) {
                alert("Configurações salvas com sucesso.");
                initBackground();
            }

        } catch (error) {
            // Captura e lida com a exceção
            console.error("Ocorreu um erro:", error.message);
        }
    });

    return true;
}

function initBackground() {
    chrome.runtime.sendMessage({
        type: "reset-player"
    });
}
